
@model Eleave.Models.FileUploadModel
@{ ViewBag.Title = "บันทึกการลา"; }
<style>
    .filepond--credits {
        display: none;
    }
</style>

<div class="page-header">
    <div class="page-block">
        <div class="row align-items-center">
            <div class="col-md-12">
                <div class="page-header-title">
                    <h5 class="m-b-10">บันทึกการลา</h5>
                </div>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")"><i class="feather icon-home"></i></a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("RequestForm","Leave")">บันทึกการลา</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
@*@using (Html.BeginForm("SaveRequestForm", "Leave", /*new { userID = @Model.ProPit_User.userID },*/ FormMethod.Post, new { enctype = "multipart/form-data" }))
    {*@
<div class="row">
    <div class="col-sm-12">
        <div class="card">
            <div class="card-header">
                <h5>เลขที่การลา <span class="badge badge-light-secondary" style="font-size: 16px;"> @ViewBag.DocumentRequest </span></h5>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <input type="hidden" id="ReqNo" value="@ViewBag.DocumentRequest">
                    <div class="col-md-3 mb-3">
                        <label for="validationTooltip02" class="font-weight-bold">ประเภทการร้องขอ</label>
                        <select id="inputState" class="form-control">
                            <option selected>Leave</option>
                            <option>Leave2</option>
                            <option>Leave3</option>
                        </select>
                    </div>
                    <div class="col-md-9 mb-9">
                        <label for="validationTooltip03" class="font-weight-bold">ประเภทการลา</label>
                        <select id="ReqId" name="ReqId" class="form-control" onchange="getConditionReq(this.value);">
                            <option value="1" selected>ลาป่วย</option>
                            <option value="2">ลากิจ</option>
                            <option value="3">ลาพักร้อน</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="col-md-6 mb-6">
                        <label for="validationTooltip04" class="font-weight-bold">วันที่ลา(จาก-ถึง)</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="inputGroupPrepend"><i class="fa fa-calendar"></i></span>
                            </div>
                            <input type="text" class="form-control" name="daterange" id="dates-available-from" placeholder="จาก" aria-describedby="inputGroupPrepend" required>
                            @*<div class="input-group-prepend">
                                    <span class="input-group-text" id="inputGroupPrepend"><i class="fa fa-calendar"></i></span>
                                </div>
                                <input type="text" class="form-control" id="endDate" placeholder="ถึง" aria-describedby="inputGroupPrepend" required>*@
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="validationTooltip03" class="font-weight-bold">ช่วงเวลา</label>
                        <select id="inputState" class="form-control">
                            <option selected>ทั้งวัน</option>
                            <option>ช่วงเช้า</option>
                            <option>ช่วงบ่าย</option>
                        </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="validationTooltip03" class="font-weight-bold">จำนวนวัน</label>
                        <input type="text" class="form-control" name="NumDay" id="NumDay" placeholder="จำนวนวัน">
                    </div>
                </div>

                <!--<div class="form-row">
                    <div class="col-md-12 mb-12">
                        <label for="validationTooltip04" class="font-weight-bold">วันที่ลา(ถึง)</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="inputGroupPrepend"><i class="fa fa-calendar"></i></span>
                            </div>
                            <input type="text" class="form-control" name="daterange" id="dates-available-from" placeholder="จาก" aria-describedby="inputGroupPrepend" required>-->
                @*<div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroupPrepend">ถึง</span>
                    </div>
                    <input type="text" class="form-control" name="end" id="dates-available-to" placeholder="ถึง" aria-describedby="inputGroupPrepend" required>
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroupPrepend"><i class="fa fa-calendar"></i></span>
                    </div>*@
                <!--</div>

                    </div>
                </div>-->

                <div class="form-row">
                    <div class="col-md-12 mb-12">
                        <label for="exampleFormControlTextarea1" class="font-weight-bold">หมายเหตุการลา</label>
                        <div class="form-group">
                            <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="col-md-12 mb-12">
                        <label for="validationTooltip03" class="font-weight-bold">Attach File</label>
                        <div class="row">
                            <div class="col">
                                <div class="file-loading">
                                    <input id="file_upload_multi" name="file_upload_multi[]" type="file" multiple="multiple">
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="row">
                    <div class="col-sm-12 text-right">
                        <button class="btn btn-primary btn-md" type="button" onclick="btnSubmitRequest();">บันทึก</button>
                        <button class="btn btn-warning btn-md">ล้าง</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@* } *@
@* krajee *@
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.0/js/plugins/buffer.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.0/js/plugins/filetype.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.0/js/plugins/piexif.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.0/js/plugins/sortable.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.0/js/fileinput.min.js"></script>

<script defer>
    function btnSubmitRequest() {
        var ReqNo = $("#ReqNo").val();
        var formData = new FormData();
        var totalFiles = document.getElementById("file_upload_multi").files.length;
        for (var i = 0; i < totalFiles; i++) {
            var file = document.getElementById("file_upload_multi").files[i];
            formData.append("file_upload_multi", file);
        }
        formData.append('ReqNo', ReqNo);
        $.ajax({
            url: '@Url.Action("SaveRequestForm", "Leave")',
            type: 'post',
            enctype: 'multipart/form-data',
            data: formData,
            dataType: 'json',
            async: true,
            cache: false,
            contentType: false,
            processData: false,
            beforeSend: function () {
                LoadingShow();
            },
            success: function (res) {
                if (!res.status) {
                    Swal.fire({
                        html: res.msg,
                        icon: 'error',
                        confirmButtonColor: '#d33',
                        confirmButtonText: 'ปิด',
                        allowOutsideClick: false,
                        focusConfirm: false,
                    }).then((result) => {
                        Swal.fire({
                            title: 'Loading',
                            text: 'Please Wait',
                            timer: location.reload(),
                            allowOutsideClick: false,
                            focusConfirm: false,
                            onOpen: () => {
                                swal.showLoading();
                            }
                        })
                    });
                } else {
                    Swal.fire({
                        title: 'Success',
                        html: res.msg,
                        icon: 'success',
                        timer: location.reload(),
                        showConfirmButton: false,
                        allowOutsideClick: false,
                        focusConfirm: false,
                        onOpen: () => {
                            swal.showLoading();
                        }
                    })
                }
            },
            complete: function () {
                LoadingHide();
            },
        }).fail(function (error) {
            alert(error.status);
            //Swal.fire({
            //    icon: 'error',
            //    title: 'เกิดข้อผิดพลาด กรุณาแจ้งผู้ดูแลระบบ (' + error.status + ')',
            //    html: '<p>btnSubmitRequest :</p><p>' + error.responseText + '</p>',
            //    confirmButtonColor: '#d33',
            //    confirmButtonText: 'ปิด',
            //    allowOutsideClick: false,
            //    focusConfirm: false,
            //});
        });
    }

    //ประเภทวการลา
    $('#file_upload_multi').fileinput({
        fileActionSettings: {
            showUpload: false,
            showDelete: true,
        },
        showRemove: true,
        previewFileType: 'image',
        dropZoneEnabled: true,
        browseOnZoneClick: true,
        uploadAsync: true,
        theme: 'fa',
        removeFromPreviewOnError: true,
        showPreview: true,
        showUpload: false,
        browseOnZoneClick: true,
        allowedPreviewTypes: false,
        //showUpload: false,
        //initialPreviewShowDelete: true,
        //initialPreviewAsData: true,
        //uploadUrl: "/Home/FileUpload",
        //deleteUrl: "/Home/FileDelete",
        //uploadUrl: '@Url.Action("Leave", "SaveRequestForm")',
        maxFileCount: 3,
        maxFileSize: 500,
        maxFilePreviewSize: 10240,
        //initialPreview: true,
        //initialPreviewAsData: true,
        overwriteInitial: false,
        preferIconicPreview: true,
        previewFileIconSettings: {
            // configure your icon file extensions
            'doc': '<i class="fas fa-file-word text-primary"></i>',
            'xls': '<i class="fas fa-file-excel text-success"></i>',
            'ppt': '<i class="fas fa-file-powerpoint text-danger"></i>',
            'pdf': '<i class="fas fa-file-pdf text-danger"></i>',
            'zip': '<i class="fas fa-file-archive text-muted"></i>',
            'htm': '<i class="fas fa-file-code text-info"></i>',
            'txt': '<i class="fas fa-file-alt text-info"></i>',
            'mov': '<i class="fas fa-file-video text-warning"></i>',
            'mp3': '<i class="fas fa-file-audio text-warning"></i>',
            'jpg': '<i class="fas fa-file-image text-danger"></i>',
            'gif': '<i class="fas fa-file-image text-muted"></i>',
            'png': '<i class="fas fa-file-image text-primary"></i>'
        },
        previewFileExtSettings: { // configure the logic for determining icon file extensions
            'doc': function (ext) {
                return ext.match(/(doc|docx)$/i);
            },
            'xls': function (ext) {
                return ext.match(/(xls|xlsx)$/i);
            },
            'ppt': function (ext) {
                return ext.match(/(ppt|pptx)$/i);
            },
            'zip': function (ext) {
                return ext.match(/(zip|rar|tar|gzip|gz|7z)$/i);
            },
            'htm': function (ext) {
                return ext.match(/(htm|html)$/i);
            },
            'txt': function (ext) {
                return ext.match(/(txt|ini|csv|java|php|js|css)$/i);
            },
            'mov': function (ext) {
                return ext.match(/(avi|mpg|mkv|mov|mp4|3gp|webm|wmv)$/i);
            },
            'mp3': function (ext) {
                return ext.match(/(mp3|wav)$/i);
            }
        }
    });
    function getConditionReq(ReqId) {
        console.log("ReqId = " + ReqId);
    }
    //var diffDays = Math.abs((firstDate.getTime() - secondDate.getTime())/(oneDay));
    $(document).ready(function () {
        //$("#startDate").datepicker({
        //    language: "th",
        //    format: 'dd/mm/yyyy',
        //    startDate: new Date(),
        //    autoclose: true,
        //}).on('changeDate', function (selected) {
        //    var minDate = new Date(selected.date.valueOf());
        //    $('#endDate').datepicker('setStartDate', minDate);
        //});

        //$("#endDate").datepicker({
        //    language: "th",
        //    format: 'dd/mm/yyyy',
        //    autoclose: true,
        //}).on('changeDate', function (selected) {
        //    var minDate = new Date(selected.date.valueOf());
        //    $('#startDate').datepicker('setEndDate', minDate);
        //});

        //$('.input-daterange').datepicker({
        //    language: "th",
        //    //todayHighlight: true,
        //    format: 'dd/mm/yyyy',
        //    startDate: new Date(),
        //});

        //var fromDate = new Date();
        //$('input[id="dates-available-from"]').daterangepicker({
        //    //singleDatePicker: true,
        //    //showDropdowns: true,
        //    //autoApply: true,
        //    drops: 'down',
        //    showDropdowns: true,
        //    singleDatePicker: true,
        //    autoApply: true,
        //    timePicker: false,
        //    minimumNights: 0,
        //    minDate: moment().format('DD/MM/YYYY'),
        //    locale: {
        //        format: 'DD/MM/YYYY'
        //    },
        //    minDate: new Date()
        //}, function (start, end, label) {
        //    fromDate = start.format('DD/MM/YYYY');
        //    $('input[id="dates-available-to"]').daterangepicker({
        //        singleDatePicker: true,
        //        showDropdowns: true,
        //        autoApply: true,
        //        locale: {
        //            format: 'DD/MM/YYYY'
        //        },
        //        minDate: fromDate
        //    });
        //});
        $('input[name="daterange"]').daterangepicker({
            startDate: moment().subtract('days', 7),
            endDate: moment(),
            minDate: moment().subtract('days', 0),
            maxDate: '12/31/2024',
            dateLimit: { days: 7 },
            //showDropdowns: true,
            //showWeekNumbers: true,
            timePicker: true,
            timePickerIncrement: 2,
            timePicker12Hour: true,
            //ranges: {
            //    'Today': [moment(), moment()],
            //    'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
            //    'Last 7 Days': [moment().subtract('days', 6), moment()],
            //    'Last 30 Days': [moment().subtract('days', 29), moment()],
            //    'This Month': [moment().startOf('month'), moment().endOf('month')],
            //    'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
            //},
            autoclose: true,
            language: 'th',
            opens: 'left',
            buttonClasses: ['btn btn-default'],
            applyClass: 'btn-small btn-primary',
            cancelClass: 'btn-small',
            format: 'DD/MM/YYYY',
            separator: ' to ',
            locale: {
                format: 'DD/MM/YYYY',
                separator: "  ถึง  ",
                applyLabel: 'ตกลง',
                cancelLabel: "ยกเลิก",
                fromLabel: 'From',
                toLabel: 'To',
                customRangeLabel: 'Custom Range',
                daysOfWeek: ["อา.", "จ.", "อ.", "พ.", "พฤ.", "ศ.", "ส."],
                monthNames: ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"],
                firstDay: 1
            }
        }, function (start, end) {
            console.log("Callback has been called!");
            $('#reportrange span').html(start.format('D MMMM YYYY') + ' - ' + end.format('D MMMM YYYY'));
            console.log(start.format('DD/MM/YYYY') + ' - ' + end.format('DD/MM/YYYY'));

        }
        );

    });
</script>
